<!DOCTYPE HTML>
<div id="main"></div>
<script src="main.js"></script>
<script>
    var node = document.getElementById('main');
    var app = Elm.Main.embed(node);

    var observer = new IntersectionObserver(function (entries, observer) {
        entries.forEach(entry => {
            app.ports.onVisible.send([entry.target.id, entry.isIntersecting]);
        });
    });
    
    app.ports.observe.subscribe(function(element) {
        window.requestAnimationFrame(function(timestamp) {
            var target = document.querySelector(element);
            observer.observe(target);
        });
    });
</script>
